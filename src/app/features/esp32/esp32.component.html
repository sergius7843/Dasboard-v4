<!-- Layout principal del control de focos -->
<div class="min-h-screen bg-dark-900 flex">
  <!-- Efecto de gradiente animado de fondo -->
  <div class="header-gradient-bg"></div>

  <!-- Sidebar / Navbar lateral -->
  <aside class="w-64 bg-dark-800 border-r border-dark-700">
    <app-navbar></app-navbar>
  </aside>

  <!-- Contenido principal -->
  <div class="flex-1 flex flex-col">

    <!-- Header -->
    <header class="bg-dark-800 border-b border-dark-700 h-16">
      <app-header></app-header>
    </header>

    <!-- Área de contenido principal -->
    <main class="flex-1 p-6 bg-dark-900">
      <div class="max-w-7xl mx-auto">

        <!-- Título de la página -->
        <div class="mb-8">
          <h1 class="text-3xl font-bold text-dark-50 mb-2">
            Control de Focos - Auditorio UNIFRANZ
          </h1>
          <p class="text-dark-400">
            Sistema de control de iluminación para el auditorio universitario
          </p>
        </div>

        <!-- Estado de conexión y resumen -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <!-- Estado de conexión -->
          <div class="connection-card" [class.connected]="isConnected" [class.disconnected]="!isConnected">
            <div class="flex items-center">
              <div class="status-indicator">
                <div class="status-dot"></div>
              </div>
              <div class="status-info">
                <h3 class="status-title">{{ isConnected ? 'ESP32 Conectado' : 'ESP32 Desconectado' }}</h3>
                <p class="status-subtitle">{{ isConnected ? 'Sistema operativo' : 'Reconectando...' }}</p>
              </div>
            </div>
          </div>

          <!-- Resumen de zonas activas -->
          <div class="summary-card">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-lg font-semibold text-dark-50">Zonas Activas</h3>
                <p class="text-2xl font-bold text-primary-500">{{ activeZones }}/{{ totalZones }}</p>
              </div>
              <div class="summary-icon">
                <svg class="w-8 h-8 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>
              </div>
            </div>
          </div>

          <!-- Control maestro -->
          <div class="master-control-card">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-lg font-semibold text-dark-50">Control Maestro</h3>
                <p class="text-dark-400">{{ allLightsOn ? 'Todas encendidas' : 'Algunas apagadas' }}</p>
              </div>
              <button
                (click)="toggleAllLights()"
                [disabled]="!isConnected"
                class="master-toggle"
                [class.all-on]="allLightsOn"
                [class.some-off]="!allLightsOn">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Escenarios predefinidos -->
        <div class="scenarios-section mb-8">
          <h2 class="text-xl font-semibold text-dark-50 mb-4">Escenarios Predefinidos</h2>
          <div class="scenarios-grid">
            <button
              (click)="setScenario('presentation')"
              [disabled]="!isConnected"
              class="scenario-btn presentation">
              <div class="scenario-icon">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2h3a1 1 0 011 1v14a1 1 0 01-1 1H4a1 1 0 01-1-1V5a1 1 0 011-1h3z"></path>
                </svg>
              </div>
              <div class="scenario-info">
                <h3>Presentación</h3>
                <p>Solo escenario</p>
              </div>
            </button>

            <button
              (click)="setScenario('full')"
              [disabled]="!isConnected"
              class="scenario-btn full">
              <div class="scenario-icon">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
              </div>
              <div class="scenario-info">
                <h3>Completo</h3>
                <p>Todas las zonas</p>
              </div>
            </button>

            <button
              (click)="setScenario('break')"
              [disabled]="!isConnected"
              class="scenario-btn break">
              <div class="scenario-icon">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
              </div>
              <div class="scenario-info">
                <h3>Descanso</h3>
                <p>Solo público</p>
              </div>
            </button>

            <button
              (click)="setScenario('emergency')"
              [disabled]="!isConnected"
              class="scenario-btn emergency">
              <div class="scenario-icon">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
              </div>
              <div class="scenario-info">
                <h3>Emergencia</h3>
                <p>Seguridad</p>
              </div>
            </button>
          </div>
        </div>

        <!-- Control individual de zonas -->
        <div class="zones-section">
          <h2 class="text-xl font-semibold text-dark-50 mb-6">Control Individual de Zonas</h2>

          <div class="zones-grid">
            <div *ngFor="let zone of lightZones" class="zone-card">

              <!-- Header de la zona -->
              <div class="zone-header">
                <div class="zone-icon-container">
                  <svg class="zone-icon" [class.active]="zone.isOn" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="getZoneIcon(zone.icon)"></path>
                  </svg>
                </div>
                <div class="zone-info">
                  <h3 class="zone-title">{{ zone.name }}</h3>
                  <p class="zone-description">{{ zone.description }}</p>
                </div>
              </div>

              <!-- Estado de la zona -->
              <div class="zone-status">
                <div class="status-indicator-row">
                  <div class="status-light" [class.on]="zone.isOn" [class.off]="!zone.isOn"></div>
                  <span class="status-text" [ngClass]="getStatusColor(zone.isOn)">
                    {{ getStatusText(zone.isOn) }}
                  </span>
                </div>
                <div class="last-update" *ngIf="zone.lastUpdate">
                  <span class="text-dark-500 text-sm">
                    Última actualización: {{ formatLastUpdate(zone.lastUpdate) }}
                  </span>
                </div>
              </div>

              <!-- Controles de la zona -->
              <div class="zone-controls">
                <button
                  (click)="turnOnLight(zone.id)"
                  [disabled]="!isConnected || zone.isOn"
                  class="zone-btn on"
                  [class.active]="zone.isOn">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                  </svg>
                  Encender
                </button>

                <button
                  (click)="turnOffLight(zone.id)"
                  [disabled]="!isConnected || !zone.isOn"
                  class="zone-btn off"
                  [class.active]="!zone.isOn">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                  </svg>
                  Apagar
                </button>

                <button
                  (click)="toggleLight(zone.id)"
                  [disabled]="!isConnected"
                  class="zone-btn toggle">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                  </svg>
                  Toggle
                </button>
              </div>

            </div>
          </div>
        </div>

        <!-- Controles de emergencia -->
        <div class="emergency-section mt-8">
          <div class="emergency-card">
            <div class="emergency-header">
              <div class="emergency-icon">
                <svg class="w-6 h-6 text-danger-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-dark-50">Controles de Emergencia</h3>
                <p class="text-dark-400">Acceso rápido a funciones críticas</p>
              </div>
            </div>
            
            <div class="emergency-controls">
              <button
                (click)="turnOffAllLights()"
                [disabled]="!isConnected"
                class="emergency-btn danger">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"></path>
                </svg>
                Apagar Todo
              </button>

              <button
                (click)="turnOnAllLights()"
                [disabled]="!isConnected"
                class="emergency-btn success">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
                Encender Todo
              </button>
            </div>
          </div>
        </div>

      </div>
    </main>

    <!-- Footer -->
    <app-footer></app-footer>

  </div>
</div>